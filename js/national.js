var proArr = [{
	"id" : 0,
	"name" : "上海",
	"src" : "img/province/上海.png",
	"top" : "272px",
	"left" : "470px",
	"width" : "50px",
	"height" : "20px"
},{
	"id" : 1,
	"name" : "北京",
	"src" : "img/province/北京.png",
	"top" : "164px",
	"left" : "402px",
	"width" : "70px",
	"height" : "37px"
},{
	"id" : 2,
	"name" : "新疆",
	"src" : "img/province/新疆.png",
	"top" : "60px",
	"left" : "5px",
	"width" : "220px",
	"height" : "161px"
},{
	"id" : 3,
	"name" : "内蒙古",
	"src" : "img/province/内蒙古.png",
	"top" : "26px",
	"left" : "229px",
	"width" : "247px",
	"height" : "193px"
},{
	"id" : 4,
	"name" : "黑龙江",
	"src" : "img/province/黑龙江.png",
	"top" : "12px",
	"left" : "428px",
	"width" : "120px",
	"height" : "108px"
},{
	"id" : 5,
	"name" : "吉林",
	"src" : "img/province/吉林.png",
	"top" : "90px",
	"left" : "450px",
	"width" : "90px",
	"height" : "70px"
},{
	"id" : 6,
	"name" : "辽宁",
	"src" : "img/province/辽宁.png",
	"top" : "128px",
	"left" : "435px",
	"width" : "66px",
	"height" : "65px"
},{
	"id" : 7,
	"name" : "河北",
	"src" : "img/province/河北.png",
	"top" : "141px",
	"left" : "387px",
	"width" : "60px",
	"height" : "86px"
},{
	"id" : 8,
	"name" : "山西",
	"src" : "img/province/山西.png",
	"top" : "174px",
	"left" : "357px",
	"width" : "42px",
	"height" : "76px"
},{
	"id" : 9,
	"name" : "陕西",
	"src" : "img/province/陕西.png",
	"top" : "188px",
	"left" : "304px",
	"width" : "66px",
	"height" : "98px"
},{
	"id" : 10,
	"name" : "宁夏",
	"src" : "img/province/宁夏.png",
	"top" : "191px",
	"left" : "302px",
	"width" : "26px",
	"height" : "52px"
},{
	"id" : 11,
	"name" : "甘肃",
	"src" : "img/province/甘肃.png",
	"top" : "146px",
	"left" : "190px",
	"width" : "150px",
	"height" : "128px"
},{
	"id" : 12,
	"name" : "青海",
	"src" : "img/province/青海.png",
	"top" : "186px",
	"left" : "144px",
	"width" : "139px",
	"height" : "98px"
},{
	"id" : 13,
	"name" : "西藏",
	"src" : "img/province/西藏.png",
	"top" : "210px",
	"left" : "33px",
	"width" : "202px",
	"height" : "128px"
},{
	"id" : 14,
	"name" : "四川",
	"src" : "img/province/四川.png",
	"top" : "251px",
	"left" : "222px",
	"width" : "115px",
	"height" : "109px"
},{
	"id" : 15,
	"name" : "重庆",
	"src" : "img/province/重庆.png",
	"top" : "276px",
	"left" : "307px",
	"width" : "51px",
	"height" : "54px"
},{
	"id" : 16,
	"name" : "湖北",
	"src" : "img/province/湖北.png",
	"top" : "265px",
	"left" : "340px",
	"width" : "83px",
	"height" : "51px"
},{
	"id" : 17,
	"name" : "河南",
	"src" : "img/province/河南.png",
	"top" : "223px",
	"left" : "361px",
	"width" : "64px",
	"height" : "65px"
},{
	"id" : 18,
	"name" : "山东",
	"src" : "img/province/山东.png",
	"top" : "199px",
	"left" : "404px",
	"width" : "72px",
	"height" : "50px"
},{
	"id" : 19,
	"name" : "江苏",
	"src" : "img/province/江苏.png",
	"top" : "233px",
	"left" : "420px",
	"width" : "60px",
	"height" : "53px"
},{
	"id" : 20,
	"name" : "安徽",
	"src" : "img/province/安徽.png",
	"top" : "243px",
	"left" : "407px",
	"width" : "53px",
	"height" : "63px"
},{
	"id" : 21,
	"name" : "浙江",
	"src" : "img/province/浙江.png",
	"top" : "284px",
	"left" : "445px",
	"width" : "41px",
	"height" : "47px"
},{
	"id" : 22,
	"name" : "福建",
	"src" : "img/province/福建.png",
	"top" : "319px",
	"left" : "426px",
	"width" : "46px",
	"height" : "59px"
},{
	"id" : 23,
	"name" : "江西",
	"src" : "img/province/江西.png",
	"top" : "300px",
	"left" : "399px",
	"width" : "50px",
	"height" : "70px"
},{
	"id" : 24,
	"name" : "湖南",
	"src" : "img/province/湖南.png",
	"top" : "302px",
	"left" : "346px",
	"width" : "60px",
	"height" : "70px"
},{
	"id" : 25,
	"name" : "贵州",
	"src" : "img/province/贵州.png",
	"top" : "317px",
	"left" : "285px",
	"width" : "68px",
	"height" : "56px"
},{
	"id" : 26,
	"name" : "云南",
	"src" : "img/province/云南.png",
	"top" : "319px",
	"left" : "216px",
	"width" : "100px",
	"height" : "93px"
},{
	"id" : 27,
	"name" : "广西",
	"src" : "img/province/广西.png",
	"top" : "350px",
	"left" : "298px",
	"width" : "85px",
	"height" : "58px"
},{
	"id" : 28,
	"name" : "广东",
	"src" : "img/province/广东.png",
	"top" : "357px",
	"left" : "362px",
	"width" : "80px",
	"height" : "61px"
},{
	"id" : 29,
	"name" : "海南",
	"src" : "img/province/海南.png",
	"top" : "415px",
	"left" : "347px",
	"width" : "29px",
	"height" : "25px"
},{
	"id" : 30,
	"name" : "台湾",
	"src" : "img/province/台湾.png",
	"top" : "353px",
	"left" : "473px",
	"width" : "20px",
	"height" : "40px"
}];
//省份对象
function Province (i){
	this.dom = null;	//省份dom元素
	this.isBingo = 1;		//创建对象时判断其是否已成功
	this.name = proArr[i]["name"];
	this.src = proArr[i]["src"];	//图片路径
	this.width = proArr[i]["width"] ;	//宽
	this.height = proArr[i]["height"] ;	//高
	this.left = proArr[i]["left"] ;		//左边
	this.top = proArr[i]["top"];		//右边
}
//初始化一个省份
Province.prototype.init = function(){
	this.dom = document.createElement("img");
	this.dom.className = "prov";
	this.dom.src = this.src;
	this.dom.style.width = this.width;
	this.dom.style.height = this.height;
	this.dom.style.left = this.left;
	this.dom.style.top = this.top;
	document.getElementById('map-box').appendChild(this.dom);
}
//随机初始化一个省份
Province.prototype.suiinit = function(){
	this.dom = document.createElement("img");
	this.dom.className = "prov";
	this.dom.src = this.src;
	this.dom.style.width = this.width;
	this.dom.style.height = this.height;
	this.dom.style.left = RandomLeft() + "px";
	this.dom.style.top = Math.random()*500-130 + "px";
	document.getElementById('map-box').appendChild(this.dom);
}
var allLastNum = 0; 	//建立剩余总数
var timer1 = 0;
var timer2 = 0;
var provObj = [];		//创建省份数组对象

var isAudioON = 1;		//声音信号量
var oMediaBg = document.getElementById('audio-bg');
var oMediaBingo = document.getElementById('audio-bingo');
var oMediaWin = document.getElementById('audio-win');
var oMediaFail = document.getElementById('audio-fail');


window.onload = function(){
	
	document.getElementById('audio-btn').onclick = function(){
		if(isAudioON === 1){
			isAudioON = 0;
			oMediaBg.pause();
			oMediaBingo.pause();
			oMediaFail.pause();
			oMediaWin.pause();
			this.src = "img/audio-y-off.png";
		}else{
			isAudioON = 1;
			oMediaBg.play();
			this.src = "img/audio-y-on.png";
		}
	}
}


var startBtn = document.getElementsByClassName('trigger')[0];

startBtn.addEventListener("click",function(){
	document.getElementById('back-white').style.display = "none";
	start();
});

function start(){
	oMediaBg.play();
	var lastNum = 0;		//剩余数量
	for(var i = 2 ; i <= 30 ; i ++){
	//	document.body.innerHTML += `<img src="${proArr[i]["src"]}"/>`;
		var isAppend = Math.random() * 10;
		if(isAppend >= 6){		
			var prov = new Province(i);
			prov.isBingo = 0;
			prov.suiinit();
			allLastNum ++;
			if(i === 10){
				prov.dom.style.zIndex = 60;
			}
		}else{
			var prov = new Province(i);
			prov.isBingo = 1;
			prov.init();
		}
		provObj.push(prov);
		//console.log(prov.name,prov.isBingo);
	}
	//开始计时
	clearInterval(timer1);
	timer1 = setInterval(timeDown1,105);
	clearInterval(timer2);
	timer2 = setInterval(timeDown2,1000);
	
	//跟新页面的剩余数量
	document.getElementById('lastnum').innerHTML = allLastNum;
	var oImgs = document.getElementsByClassName("prov");
	
	for(var i = 2;i < oImgs.length;i++){
		console.log(provObj[i-2]["isBingo"]);
		if(provObj[i-2]["isBingo"] === 0){
			(function(i){
				oImgs[i].onmousedown = (event) =>{
					event = event || window.event;
					console.log(event.target);
					//console.log(i);
					event.preventDefault();
					
					var delayX = event.clientX - oImgs[i].offsetLeft;
					var delayY = event.clientY - oImgs[i].offsetTop;
					document.onmousemove = function(event){
						oImgs[i].style.left = event.clientX - delayX + "px";
						oImgs[i].style.top = event.clientY - delayY + "px";
					}
				}
				oImgs[i].onmouseup = () =>{
					document.onmousemove = "";
					var nowImg = document.getElementsByClassName("prov")[i];
					var bleft = parseInt(proArr[i]["left"]);
					var btop = parseInt(proArr[i]["top"]);
					var nleft = nowImg.offsetLeft;
					var ntop = nowImg.offsetTop;
					if(((nleft>=bleft-10)&&(nleft<=bleft+10))&&((ntop>=btop-10)&&(ntop<=btop+10))){
						nowImg.style.left = bleft + "px";
						nowImg.style.top = btop + "px";
						nowImg.onmousedown = "";
						bingo();
					}
				}
				if(oImgs[i].isBingo === 1){
					oImgs[i].onmousedown = "";
				}
			}(i));
		}
		
	}
}
var timeDown1 = function(){
	var timeHeight = document.getElementById("timeheight");
	timeHeight.style.top = parseInt(timeHeight.offsetTop) + 1 + "px";
};
var timeDown2 = function(){
	var timeNum = document.getElementById("timenum");
	timeNum.innerHTML = parseInt(timeNum.innerHTML) - 1 + "s";
	if(parseInt(timeNum.innerHTML)<=0){
		clearInterval(timer1);
		clearInterval(timer2);
//		for(var i=0;i<=oImgs.length;i++){
			document.onmousemove = "";
//		}
		if(isAudioON===1){
			oMediaFail.play();			
		}
		if(confirm("挑战失败！！是否进入下一个游戏，确定进入，取消再进行本游戏")){
			location.href = "mid-autumn.html";
		}else{
			location.href = "national.html";
		}
		
		
	}
};


function bingo(){
	var lastNum = document.getElementById('lastnum');
	var hoooo = document.getElementById("hoooo");
	if(isAudioON===1){		
		oMediaBingo.play();
	}
	lastNum.innerHTML -- ;
	if(lastNum.innerHTML <= 0){
		clearInterval(timer1);
		clearInterval(timer2);
		$(hoooo).animate({"left":"30px"},400);
		if(isAudioON===1){			
			oMediaWin.play();
		}
		if(confirm("挑战成功！！是否进入下一个游戏，确定进入，取消再进行本游戏")){
			location.href = "mid-autumn.html";
		}else{
			location.href = "national.html";
		}
	}else{		
		$(hoooo).animate({"left":"30px"},400,function(){
			setTimeout(function(){
				$(hoooo).animate({"left":"-180px"},400);		
			},500);
		});
	}
}

//在一定的范围内，产生随机数
function RandomLeft(){
	var left = Math.random() * 1100 - 260;
	if(left <= -100 || left >= 700){
		return left;
	}else{
		return RandomLeft();
	}
}

document.getElementById('next-btn').onclick = function(){
	location.href = "mid-autumn.html";
}

document.getElementById('back-btn').onclick = function(){
	location.href = "index.html";
}

